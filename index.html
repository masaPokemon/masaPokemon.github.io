<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>クッキーとURLパラメータをFirebaseに送信</title>
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-database.js"></script>
</head>
<body>
    <h1>クッキーとURLパラメータをFirebaseに送信</h1>
    <button onclick="sendDataToFirebase()">送信</button>

    <script>
        // Firebaseの設定（自分のプロジェクトの情報に変更してください）
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBBbo6xLhmufq0LiFaw8bKTDQ9JOthd0HY",
            authDomain: "lets-go-to-school-server.firebaseapp.com",
            databaseURL: "https://lets-go-to-school-server-default-rtdb.firebaseio.com",
            projectId: "lets-go-to-school-server",
            storageBucket: "lets-go-to-school-server.appspot.com",
            messagingSenderId: "149825716219",
            appId: "1:149825716219:web:0ef095d5d77ab10b29155e",
            measurementId: "G-SJJ81FP9VS"
        };

        // Firebaseの初期化
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // クッキーを取得する関数
        function getCookies() {
            const cookies = document.cookie.split("; ");
            let cookieObj = {};
            cookies.forEach(cookie => {
                const [key, value] = cookie.split("=");
                cookieObj[key] = value;
            });
            return cookieObj;
        }

        // "?t=" の後ろの値を取得する関数
        function getTValue() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get("t") || "なし"; // "t" がない場合は "なし" を返す
        }

        // Firebaseにデータを送信
        function sendDataToFirebase() {
            const tValue = getTValue();
            
            const data = {
                t_value: tValue,
                timestamp: new Date().toISOString()  // 送信時間も記録
            };

            database.ref("user_data").push(data)
                .then(() => alert("データを送信しました！"))
                .catch(error => console.error("エラー:", error));
        }
    </script>
</body>
</html>
